<!DOCTYPE html>
<html lang="en-us">

<head>
    <meta charset="utf-8">
    <title>開啟Cytoid</title>
</head>

<body>
    <div>
    </div>
    <p></p>
    <script>
        var lang = window.navigator.language || window.navigator.userLanguage
        var context;
        if (lang.startsWith("en")) {
            context = "Open this page in \"Cytoid\"?"
        }
        else {
            context = "是否開啟Cytoid?"
        }
        // 獲取整個query字符串
        var queryString = window.location.search;

        // 解析query字符串成為一個物件
        var params = new URLSearchParams(queryString);
        var url = "cytoid://"
        var web = "https://next.cytoid.io/"
        // 檢查 "levels" 參數是否存在
        if (params.has("levels")) {
            var levels = params.get("levels");
            if (isMobileDevice()) {
                var choice = confirm(context)
                if (choice) {
                    openApp(url + "levels/" + levels);
                    setTimeout(function () { opeWeb(web + "levels/" + levels); }, 800);
                }
                else {
                    opeWeb(web + "levels/" + levels);
                }
            }
            else {
                opeWeb(web + "levels/" + levels);
            }
            // 在這裡執行相應的操作，因為 "levels" 參數存在
        }
        else {
            alert("404 Page not found")
        }

        function isMobileDevice() {
            var mobileDevice = ['Android', 'webOS', 'iPhone', 'iPad', 'iPod', 'BlackBerry', 'Windows Phone']
            var isMobileDevice = false
            for (var i = 0; i < mobileDevice.length; i++) {
                if (navigator.userAgent.match(mobileDevice[i])) {
                    isMobileDevice = true
                }
            }
            return isMobileDevice
        }

        function opeWeb(webUrl) {
            window.location.href = webUrl;
        }


        function openApp(appUrl, webUrl) {
            window.location.href = appUrl;
            setTimeout(function () { window.close(); }, 5000);
        }
    </script>
</body>

</html>
